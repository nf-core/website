---
import PageLayout from "@layouts/PageLayout.astro";
import { getCollection } from "astro:content";
import type { SidebarEntry } from "@utils/types";
import { addEntriesToSection, sanitizeNfCoreLabels } from "@utils/functions";
import { Icon } from "astro-icon/components";
import SidebarNav from "@components/sidebar/SidebarNav.astro";

let docs = await getCollection("docs");

let sections: SidebarEntry[] = [
    {
        type: "group",
        id: "get-started",
        label: "Get started",
        entries: [],
        collapsed: true,
        icon: "octicon:play-16",
        weight: 1,
    },
    {
        type: "group",
        id: "users",
        label: "Running",
        entries: [],
        collapsed: true,
        icon: "octicon:git-branch-16",
        weight: 2,
    },
    {
        type: "group",
        id: "developers",
        label: "Developing",
        entries: [],
        collapsed: true,
        icon: "octicon:git-commit-16",
        weight: 3,
    },
    {
        type: "group",
        id: "contributors",
        label: "Contributing",
        entries: [],
        collapsed: true,
        icon: "octicon:git-pull-request-16",
        weight: 4,
    },
    {
        type: "group",
        id: "specifications",
        label: "Specifications",
        entries: [],
        collapsed: true,
        icon: "octicon:checklist-16",
        weight: 5,
    },
    {
        type: "group",
        id: "community",
        label: "Community",
        entries: [],
        collapsed: true,
        icon: "mdi:sprout",
        weight: 6,
    },
    {
        type: "group",
        id: "nf-core-tools",
        label: "nf-core/tools",
        entries: [],
        collapsed: true,
        icon: "octicon:tools-16",
        weight: 7,
    },
];

addEntriesToSection(sections, docs, Astro.url.pathname);
// sort all entries by weight if available recursively
const sortEntries = (entries: SidebarEntry[]) => {
    entries.sort((a, b) => {
        if (a.weight && !b.weight) {
            return -1;
        } else if (!a.weight && b.weight) {
            return 1;
        } else if (a.weight && b.weight && a.weight !== b.weight) {
            if (a.weight < b.weight) {
                return -1;
            } else if (a.weight > b.weight) {
                return 1;
            }
        } else {
            return a.label.localeCompare(b.label);
        }
    });
    entries.forEach((entry) => {
        if (entry.type === "group" && entry.entries) {
            sortEntries(entry.entries);
        }
    });
};

sections.forEach((section) => {
    sortEntries(section.entries);
});

// Define featured "Get started" pages - these will be large cards with icons
const featuredPages = [
    {
        title: "What is nf-core?",
        href: "/docs/get_started/nf-core",
        icon: "octicon:play-16",
        description: "Introduction to the nf-core project and community"
    },
    {
        title: "Environment setup",
        href: "/docs/get_started/environment_setup/overview",
        icon: "octicon:gear-16",
        description: "Set up your system to run nf-core pipelines"
    },
    {
        title: "Run your first pipeline",
        href: "/docs/get_started/run-your-first-pipeline",
        icon: "octicon:terminal-16",
        description: "Step-by-step guide to running an nf-core pipeline"
    },
];

// Create featured page entries
const featuredEntries = featuredPages.map(({ title, href, icon, description }) => ({
    label: title,
    href: href,
    customIcon: icon,
    description: description,
    metadata: { data: { title: title } },
}));

// Define main sections with descriptions
const mainSections = [
    {
        section: "Running",
        sectionHref: "/docs/users/",
        icon: "octicon:git-branch-16",
        description: "Learn how to run nf-core pipelines and configure them for your needs",
    },
    {
        section: "Developing",
        sectionHref: "/docs/developers/",
        icon: "octicon:git-commit-16",
        description: "Create and maintain nf-core pipelines and modules",
    },
    {
        section: "Contributing",
        sectionHref: "/docs/contributors/",
        icon: "octicon:git-pull-request-16",
        description: "Contribute to the nf-core community and projects",
    },
    {
        section: "Specifications",
        sectionHref: "/docs/specifications/",
        icon: "octicon:checklist-16",
        description: "Technical specifications and standards for nf-core components",
    },
    {
        section: "Community",
        sectionHref: "/docs/community/",
        icon: "mdi:sprout",
        description: "Community resources, brand guidelines, and terminology",
    },
    {
        section: "nf-core/tools",
        sectionHref: "/docs/nf-core-tools/",
        icon: "octicon:tools-16",
        description: "Command-line tools and API for working with nf-core",
    },
];


// Define training cards
const trainingCards = [
    {
        title: "Nextflow documentation",
        href: "https://www.nextflow.io/docs/latest/index.html",
        icon: "octicon:book-16",
        description: "Official Nextflow language documentation and guides"
    },
    {
        title: "Nextflow and nf-core training",
        href: "https://training.nextflow.io/latest/",
        icon: "octicon:mortar-board-16",
        description: "Hands-on training materials and workshops"
    },
];
---

<PageLayout
    title="nf-core documentation"
    subtitle="Learn to use nf-core pipelines, develop workflows, and contribute to the community"
    mainpage_container={false}
>
    <div class="container-fluid main-content">
        <div class="row">
            <div class="col-12 col-xl-8 order-2">
                <!-- Featured Cards -->
                <div class="featured-section mb-5">
                    <h2 class="section-heading mb-2">Get started</h2>
                    <p class="mb-4">New to nf-core? Start here to learn the basics and run your first pipeline.</p>
                    <div class="grid gap-3">
                        {
                            featuredEntries.map((page) => (
                                <a href={page.href} class="text-decoration-none g-col-12 g-col-md-6 g-col-lg-4">
                                    <div class="card h-100 featured-card">
                                            <div class="card-body">
                                                <div class="featured-icon mb-2">
                                                    <Icon name={page.customIcon} />
                                                </div>
                                                <h3 class="h5 card-title mb-2">
                                                    {page.metadata?.data.title || page.label}
                                                </h3>
                                                <p class="card-description mb-0">{page.description}</p>
                                            </div>
                                    </div>
                                </a>
                            ))
                        }
                    </div>
                </div>

                <!-- Main Sections -->
                <div class="mb-5">
                    <h2 class="section-heading mb-2">Topics</h2>
                    <p class="mb-4">Explore documentation by topic to find what you need.</p>
                    <div class="grid gap-3">
                        {
                            mainSections.map((section) => (
                                <a href={section.sectionHref} class="text-decoration-none g-col-12 g-col-md-6 g-col-lg-4">
                                    <div class="card h-100 section-card">
                                        <div class="card-body">
                                            <div class="section-icon mb-2">
                                                <Icon name={section.icon} />
                                            </div>
                                            <h2 class="h5 card-title mb-2">{section.section}</h2>
                                            <p class="card-description mb-0">{section.description}</p>
                                        </div>
                                    </div>
                                </a>
                            ))
                        }
                    </div>
                </div>

                <!-- Other Resources Section -->
                <div class="mb-5">
                    <h2 class="section-heading mb-2">Additional resources</h2>
                    <p class="mb-4">
                        Learn Nextflow and nf-core through comprehensive documentation and hands-on training
                        materials.
                    </p>
                    <div class="grid gap-3">
                        {
                            trainingCards.map((card) => (
                                <a href={card.href} class="text-decoration-none g-col-12 g-col-md-6">
                                    <div class="card h-100 featured-card">
                                            <div class="card-body">
                                                <div class="featured-icon mb-2">
                                                    <Icon name={card.icon} />
                                                </div>
                                                <h3 class="h5 card-title mb-2">{card.title}</h3>
                                                <p class="card-description mb-0">{card.description}</p>
                                            </div>
                                    </div>
                                </a>
                            ))
                        }
                    </div>
                </div>
            </div>
            <div class="col-12 col-xl-3 sticky-top-under d-none d-xl-inline sidebar-left order-1">
                <SidebarNav items={sections} />
            </div>
        </div>
    </div>
</PageLayout>
<style>
    /* Intro Text */
    .intro-text {
        .lead {
            color: var(--bs-body-color);
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 0;
        }
    }

    /* Section headings */
    .section-heading {
        color: var(--bs-heading-color);
        font-weight: 600;
        font-size: 1.75rem;
    }

    .section-subheading {
        color: var(--bs-secondary-color);
        font-size: 1.25rem;
        line-height: 1.5;
    }

    /* Featured "Get Started" Cards */
    .featured-card {
        border: 1px solid var(--bs-border-color);
        background: var(--bs-body-bg);
        transition: border-color 0.2s ease-in-out;

        &:hover {
            border-color: var(--bs-secondary);

            .card-title {
                text-decoration: underline;
            }
        }

        .card-body {
            padding: 1.5rem;
        }

        .featured-icon {
            font-size: 24px;
            line-height: 1;

            :global(svg) {
                width: 24px !important;
                height: 24px !important;
            }
        }

        .card-title {
            color: var(--bs-heading-color);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .card-description {
            color: var(--bs-secondary-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }
    }

    /* Section Cards */
    .section-card {
        border: 1px solid var(--bs-border-color);
        background: var(--bs-body-bg);
        transition: border-color 0.2s ease-in-out;

        &:hover {
            border-color: var(--bs-secondary);

            .card-title {
                text-decoration: underline;
            }
        }

        .card-body {
            padding: 1.5rem;
        }

        .section-icon {
            font-size: 24px;
            line-height: 1;

            :global(svg) {
                width: 24px !important;
                height: 24px !important;
            }
        }

        .card-title {
            color: var(--bs-heading-color);
            font-weight: 600;
            font-size: 1.25rem;
        }

        .card-description {
            color: var(--bs-secondary-color);
            font-size: 0.95rem;
            line-height: 1.5;
        }
    }
</style>
